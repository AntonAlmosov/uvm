import React from "react";
import {
  SafeAreaView,
  StyleSheet,
  NativeSyntheticEvent,
  ScrollView,
  NativeScrollEvent,
  View,
  Dimensions,
} from "react-native";
import { NavHeader } from "../components/NavHeader";
import { ReaderHeading } from "../components/reader/ReaderHeading";
import { ReaderText } from "../components/reader/ReaderText";
import { ReaderReaction } from "../components/reader/ReaderReaction";
import { useModel } from "../model/model";
import {
  useNavigation,
  useRoute,
  RouteProp,
  useFocusEffect,
} from "@react-navigation/native";
import { data } from "../model/data.json";

type ReaderScreenRouteProps = {
  Reader: { chapter: string };
};

type ScreenProps = RouteProp<ReaderScreenRouteProps, "Reader">;

export const ReaderScreen = () => {
  const settingsState = useModel().settingsState;
  const readerState = useModel().readerState;
  const navigation = useNavigation();
  const chapterId = Number(useRoute<ScreenProps>().params.chapter);
  const chapter = data[chapterId];
  const [headerTitleShown, setHeaderTitleShown] = React.useState(false);

  useFocusEffect(() => {
    readerState.markChapterAsRead(chapterId);
  });

  const handleTitleState = (e: NativeSyntheticEvent<NativeScrollEvent>) => {
    if (e.nativeEvent.contentOffset.y > 5) setHeaderTitleShown(true);
    else setHeaderTitleShown(false);
  };

  return (
    <SafeAreaView
      style={{
        ...styles.container,
        backgroundColor: settingsState.backgroundColor,
      }}
    >
      <NavHeader
        title={"–î–µ–Ω—å " + (chapterId + 1)}
        showSettings
        showTitle={headerTitleShown}
        useSettingsConstraints
      />
      <ScrollView
        style={{
          ...styles.container,
          backgroundColor: settingsState.backgroundColor,
        }}
        onScroll={(e) => handleTitleState(e)}
        scrollEventThrottle={16}
      >
        <ReaderHeading label={chapter.title} />
        <ReaderText
          text={chapter.datatext}
          origin={"–î–µ–Ω—å " + (chapterId + 1)}
        />
        <ReaderReaction emotes={["üòñ", "üôÉ", "üé∞", "üêπ"]} />
      </ScrollView>
    </SafeAreaView>
  );
};

const styles = StyleSheet.create({
  container: {
    position: "relative",
    flex: 1,
    backgroundColor: "#fff",
  },
});

const text = `–ó–∞–∞—É–∫–∞–ª —Å—Ç–∞—Ä—ã–π –ø–µ—Ç—É—Ö.
–°–æ–º –æ—Ç–∫—Ä—ã–ª –≥–ª–∞–∑ –≤ –æ–∫–Ω–æ, —Ç–∞–º —Å–≤–µ—Ç –ø—Ä–∏—à—ë–ª –¥–æ —Å–æ–ª–Ω—Ü–∞. –û–Ω –ø–æ–¥–Ω—è–ª—Å—è, –≤—Å—Ç–∞–≤–∏–ª –Ω–æ–≥–∏ –≤ –¥–æ–º–∞—à–Ω–∏–µ –ø–æ–¥–æ—à–≤—ã –∏ –≤—Å–ø–æ–º–Ω–∏–ª –≤—á–µ—Ä–∞. –û–Ω–∞ –µ–º—É —Å–∫–∞–∑–∞–ª–∞, —á—Ç–æ –∂–µ –æ–Ω–∞ –µ–º—É —Å–∫–∞–∑–∞–ª–∞, –Ω–∞ —á—Ç–æ –æ–Ω –æ—Ç–≤–µ—Ç–∏–ª: –Ω–µ —Å–µ–≥–æ–¥–Ω—è?
–ü–ª–µ—Å–Ω—É–ª –≤ –≥–æ—Ä–ª–æ –≤–æ–¥—ã –ø—É—Å—Ç–æ–π, –≥—É–±–∞–º–∏ –∑–∞—à–∞–º–∫–∞–ª —Å–µ—Ä—ã–π –º—è–∫–∏—à, –∞ –∫–æ—Ä–∫—É –≤ –∫–∞—Ä–º–∞–Ω —É–±—Ä–∞–ª. –ü–æ—Ä–∞ –∏ –≤ –ø—É—Ç—å. –õ–æ–ø—É—Ö–æ–≤–æ–π —Ä–æ—Å–æ–π –ø—Ä–æ—Ç—ë—Ä –º–æ—Ä—â–∏–Ω—ã, –∑–µ–≤–Ω—É–ª –¥–∞ –ø—Ä–∏—â—É—Ä–∏–ª—Å—è: —Å–æ–ª–Ω—Ü–µ –∑–∞ —É–≥–ª–æ–º –¥–æ–º–∞. –¢—Ä–∞–≤–∞ –ø—Ä–∏–º—è—Ç–∞, —Å–æ–Ω–Ω–∞. –û–Ω —à—ë–ª —Ç—Ä–æ–ø–∏–Ω–∫–æ–π –∏ –≤—Å–µ–≥–¥–∞ —Å–±–∏–≤–∞–ª —à–∞–≥–∞–º —Å—á—ë—Ç.

¬´–ï—Å–ª–∏ —ç—Ç–æ–≥–æ –Ω–µ —Å–ª—É—á–∏–ª–æ—Å—å, –¥—É–º–∞–ª –º–µ–ª—å–Ω–∏–∫, —Ç–æ–≥–¥–∞ –∑–∞—á–µ–º –∑–Ω–∞—Ç—å, —á—Ç–æ –æ–Ω–∞ —Å–∫–∞–∑–∞–ª–∞? –í–∏–¥–Ω–æ, –ø—Ä–∏–¥—ë—Ç—Å—è –ø–æ–¥–æ–∂–¥–∞—Ç—å: –Ω–µ —Å–µ–≥–æ–¥–Ω—è, —Ç–∞–∫ –∑–∞–≤—Ç—Ä–∞. –ê –ø–æ–∫—É–¥–∞ –∑–µ–º–ª—è –Ω–æ—Å–∏—Ç, –¥√≥–ª–∂–Ω–æ —Å—Ç–∞—Ä–∞—Ç—å—Å—è. –ñ–∏–∑–Ω—å —Ö–æ—Ä–æ—à–∞, —Ç–µ—Ä–ø–µ—Ç—å –º–æ–∂–Ω–æ. –í–æ—Ç –∏ –∫–æ–ª–æ–¥–µ—Ü —Ç—Ä—É–¥–∏—Ç—Å—è –ø–æ —á–∞—Å–æ–≤–æ–π –∏ –ø—Ä–æ—Ç–∏–≤¬ª.

–î–µ–≤–∫–∏–Ω –∫–∞–º–µ–Ω—å –ª–µ–∂–∞–ª –Ω–∞ —Å–≤–æ—ë–º –º–µ—Å—Ç–µ.

–°–æ–º –≥–ª—è–¥–µ–ª –≤ –ø—É—Å—Ç—ã–µ –æ—á–∏ –¥–æ–º–æ–≤. –í –∫–∞–∂–¥–æ–º —Ç–∏—Ö–æ –±–∏–ª–æ—Å—å —á—É–∂–æ–µ —Å–µ—Ä–¥—Ü–µ, —Ç–∞–∫–æ–µ –∂–µ, –∫–∞–∫ —É –Ω–µ–≥–æ. –í –ø—Ä–æ–≥–æ–Ω–µ –º–µ–∂ –¢–µ–º–Ω–æ–≤—ã–º –¥–æ–º–æ–º –∏ –¥–æ–º–æ–º –ö—Ä–∏–≤—ã—Ö –≤–∏–¥–Ω–µ–ª–∞—Å—å —Ü–µ—Ä–∫–æ–≤—å —Å–æ—Å–µ–¥–Ω–µ–≥–æ —Å–µ–ª–∞. –û–Ω –ø–æ—Å–º–æ—Ç—Ä–µ–ª –Ω–∞ –µ—ë –æ–±–≤–µ—Ç—à–∞–ª—ã–µ –ø–ª–µ—á–∏, –∞ –ø–æ—Ç–æ–º –Ω–∞ —Å–≤–æ–∏. –í–ø–µ—Ä–µ–¥–∏ —Ä–µ–∫–∞ –∏ —Å–º–µ—Ä—Ç—å.

¬´–°–µ–≥–æ–¥–Ω—è –µ—Å—Ç—å –Ω–∞–¥–µ–∂–¥–∞, –º–µ—á—Ç–∞–ª –°–æ–º, –≤ —ç—Ç–æ –≤—Ä–µ–º—è —á—Ç–æ-—Ç–æ –¥–∞ —Å–ª—É—á–∞–µ—Ç—Å—è. –í–æ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—á–µ—Ä–∞ —á—Ç–æ-—Ç–æ –±—ã–ª–æ. –í–µ—á–µ—Ä–æ–º –ø—Ä–∏–¥—É, —Å–ø—Ä–æ—à—É, —á—Ç–æ –∂–µ –±—ã–ª–æ¬ª.

–ò –æ–Ω –Ω–∏–∫–∞–∫ –Ω–µ –º–æ–≥ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å, —á—Ç–æ –∂–µ –º–æ–≥–ª–æ —Å–ª—É—á–∏—Ç—å—Å—è, –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å. –ê –∫–æ–ª–∏ –±—ã–ª–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å, —Ç–æ —Ö–æ—Ç—è –±—ã –µ—ë —ç—Ö–æ –¥–æ–ª–∂–Ω–æ –±—ã–ª–æ –¥–æ–π—Ç–∏ –¥–æ –Ω–µ–≥–æ.

–ü–ª–∞—à–∫–æ—Ç–Ω—ã–π –º–æ—Å—Ç –ª–µ–∂–∞–ª —Ç–∏—Ö–æ–π —Ä–∞–∑—ä–µ–≤—à–µ–π—Å—è —Å–æ—Ä–æ–∫–æ–Ω–æ–∂–∫–æ–π. –°–æ–º —Å–ª—É—à–∞–ª –≥–ª—É—Ö–æ–π —Å—Ç—É–∫ —Å–≤–æ–∏—Ö —à–∞–≥–æ–≤. –†–æ–≤–Ω–æ —Ç–∞–∫ –∂–µ —Å—Ç—É—á–∞–ª–∏ —à–∞–≥–∏ –ª—é–±–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∏–≤—à–µ–≥–æ –∑–¥–µ—Å—å. –û–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ –∏ –ø–æ—Å–º–æ—Ç—Ä–µ–ª –Ω–∞ –≤–æ–¥—É. –í—ã—Ç–∞—â–∏–ª –∏–∑ –∫–∞—Ä–º–∞–Ω–∞ –Ω–∞–≥—Ä–µ—Ç—ã–π –∫–∞–º–µ–Ω—å, –ø–æ—Å–º–æ—Ç—Ä–µ–ª –Ω–∞ –Ω–µ–≥–æ –∏ –±—Ä–æ—Å–∏–ª –≤—ã—Å–æ–∫–æ –≤–≤–µ—Ä—Ö. –ö–∞–º–µ–Ω—å –±—É–ª—å–∫–Ω—É–ª.

–°–æ–º —É–ª—ã–±–Ω—É–ª—Å—è –∏ –ø–æ—à—ë–ª –¥–∞–ª—å—à–µ. –ü—Ä–∏—Ä–æ–¥–∞ –Ω–µ —è–≤–ª—è–µ—Ç —á—É–¥–µ—Å –∑–∞—Ä–∞–∑, –∞ –≤–æ–¥–∞ –≤—Å—ë –∂–µ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è.

–° —Ö–æ–ª–º–∞ —Å–ø—É—Å–∫–∞–ª—Å—è –∫–æ—Å–æ–π –º–∞–ª—å—á–∏–∫ –§–µ–¥—å–∫–∞, –∏–¥—É—â–∏–π –≤ –ø—É—Å—Ç–æ—Ç—É –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π. –í —Ä—É–∫–µ –æ–Ω —Å–∂–∏–º–∞–ª –Ω–∞–¥–∫—É—à–µ–Ω–Ω—É—é —Å–ª–∏–≤—É.

‚Äì –ó–¥–∞—Ä–æ–≤–∞, –°–æ–º! ‚Äì –ö—Ä–∏–∫–Ω—É–ª –§–µ–¥—å–∫–∞. ‚Äì –í—Å—ë —É—Å—ã —Ä–∞—Å—Ç–∏—à—å –¥–∞ –Ω–µ–±–æ –∫–æ–ø—Ç–∏—à—å, –º–æ–ª—á–∞–ª–∏–≤–∞—è —Ç—ã —Ä—ã–±–∞!

–°–æ–º –≤—ã—Ç–∞—â–∏–ª –∏–∑ –∫–∞—Ä–º–∞–Ω–∞ —Ö–ª–µ–±–Ω—É—é –∫–æ—Ä–∫—É –∏ –ø—Ä–æ—Ç—è–Ω—É–ª –§–µ–¥—å–∫–µ. –ú–∞–ª—å—á–∏–∫ —É–¥–∞—Ä–∏–ª –ø–æ —Ä—É–∫–µ, –∏ –∫–æ—Ä–∫–∞ —É–ø–∞–ª–∞. –°–æ–º —É—Ö–æ–¥–∏–ª, –≤ —Å–ø–∏–Ω—É –µ–º—É –¥–æ–Ω–æ—Å–∏–ª–æ—Å—å:

‚Äì –Ø —Ç–µ–±–µ –Ω–µ –ø–∞–¥–∞–ª—å—â–∏–∫! –¢–æ–∂–µ –≤–∞–∂–Ω–æ—Å—Ç—å –∑–Ω–∞—é! –ë–æ–≥ —Ç–µ–±—è –Ω–µ –ø—Ä–æ—Å—Ç–∏—Ç! –ê–π! ‚Äì –û—Ç–º–∞—Ö–∏–≤–∞–ª—Å—è –æ–Ω —Ä—É–∫–æ–π. ‚Äì –í—Å–µ—Ö –ø—Ä–æ—Å—Ç–∏—Ç. –ò –§–µ–¥—å–∫—É –ø—Ä–æ—Å—Ç–∏—Ç.

–°–æ–º –¥–≤–∏–≥–∞–ª—Å—è –ø–æ –∫—Ä—É—Ç–æ–º—É —Å—É—Ö–æ–º—É —Å–∫–ª–æ–Ω—É, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –Ω–µ —Ä–æ—Å–ª–æ –≤—ã—Å–æ–∫–æ–π —Ç—Ä–∞–≤—ã. –î—É—Ä–Ω–∞—è –ø–æ—á–≤–∞, —à–µ–ø—Ç–∞–ª –º–µ–ª—å–Ω–∏–∫, –∫–∞–∫ –º–æ—è –≥–æ–ª–æ–≤–∞. –ü–æ–¥–Ω–∏–º–∞—è—Å—å, –æ–Ω —Å–º–æ—Ç—Ä–µ–ª –Ω–∞ —Å–≤–æ–∏ –Ω–æ–≥–∏ ‚Äì —Å–∫–æ–ª–æ—á–µ–Ω–Ω—ã–µ –ø–∞–ª–∫–∏ ‚Äì –∏ —Ä–∞–¥–æ–≤–∞–ª—Å—è, —á—Ç–æ –Ω–µ —á—É–≤—Å—Ç–≤—É–µ—Ç –∏—Ö.

–ù–∞–≤–µ—Ä—Ö—É –æ–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –ø–µ—Ä–µ–¥ –∑–µ–º–Ω–æ–π –¥–ª–∏–Ω–æ–π –∏ —Å–æ—â—É—Ä–∏–ª –≥–ª–∞–∑: —Ç—É—Ç –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤—Å—ë: –µ–≥–æ —Ç–µ–Ω—å, –µ–≥–æ –¥–µ–Ω—å, –µ–≥–æ —Ç—Ä—É–¥, –µ–≥–æ –∂–∏–∑–Ω—å. –®–∏—Ä–æ–∫–∏–º –Ω–∞–≤–∑–¥–æ—à–Ω—ã–º —à–∞–≥–æ–º –æ–Ω —É—Ç–≤–µ—Ä–¥–∏–ª —Ç—Ä–æ–ø—É –∏ –≤–æ—à—ë–ª –≤ —Å–≤–æ–π —Ö—Ä–∞–º –≥–æ—Ç–æ–≤–∏—Ç—å —Ö–ª–µ–±.

–ù–∞ –∑–∞–∫–∞—Ç–µ –æ–Ω –≤—ã—à–µ–ª. –•–æ–ª–º –ø–æ–¥ –≤–µ—á–µ—Ä –æ—Å–µ–¥–∞–ª, –∞ –Ω–æ—á—å—é, –≤–æ–∑–º–æ–∂–Ω–æ, –∏ –≤–æ–≤—Å–µ —Ä–∞–∑–≥–ª–∞–∂–∏–≤–∞–ª—Å—è. –û–Ω —à—ë–ª –¥–æ–º–æ–π –±–µ–∑ –∂–µ–ª–∞–Ω–∏—è, –µ–≥–æ –≤–µ–ª–æ –æ–∂–∏–¥–∞–Ω–∏–µ.

¬´–ß—Ç–æ –±–∏—à—å —è —Ö–æ—Ç–µ–ª —É –Ω–µ—ë —Å–ø—Ä–æ—Å–∏—Ç—å, –¥—É–º–∞–ª –º–µ–ª—å–Ω–∏–∫, –≤—Ä–æ–¥–µ –±—ã —á—Ç–æ-—Ç–æ –ø—Ä–æ –≤—á–µ—Ä–∞, –¥–∞ —É–∂–µ —Å–µ–≥–æ–¥–Ω—è –∫–æ–Ω—á–∞–µ—Ç—Å—è‚Ä¶ –≠–∫–∞—è –∫—Ä—É–≥–æ–≤–µ—Ä—Ç—å¬ª.

–•–ª–µ–±–Ω–æ–π –∫–æ—Ä–∫–∏ —É –∫–æ–º–ª—è –Ω–µ –≤–∞–ª—è–ª–æ—Å—å.

–ù–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ –º–æ—Å—Ç–∞ –æ–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Ç—É–≥—É—é —Ä–µ—á–Ω—É—é –≤–æ–¥—É. –ò –º–µ—á—Ç–∞–ª —Ç–∞–∫: ¬´–ì–¥–µ-—Ç–æ —Ç–µ–ø–µ—Ä—å –º–µ—Å—Ç–æ, –∫—É–¥–∞ –∫–∞–º–µ–Ω—å —É–ø–∞–ª? –ú–æ–∂–µ—Ç, —Ä—ã–±–∞–∫ —Ç–∞–º –ª–æ–≤–∏—Ç –∏–ª–∏ –±—Ä–æ—Å–∞–µ—Ç —Å–µ—Ç–∏¬ª. –ê –¥–ª—è —á–µ–≥–æ –±—Ä–æ—Å–∞–µ—Ç, —É–∂ –Ω–µ –¥—É–º–∞–ª –∏ —à—ë–ª –¥–∞–ª—å—à–µ.

–¢–µ–º–Ω–æ—Ç–∞ —Å–ø—É—Å—Ç–∏–ª–∞—Å—å –Ω–∞ –¥–µ—Ä–µ–≤–Ω—é, –∑–∞—Ç–µ–ø–ª–∏–ª–∏—Å—å –Ω—É—Ç—Ä–∞ –¥–æ–º–æ–≤. –î–µ–≤–∫–∏–Ω –∫–∞–º–µ–Ω—å –ª–µ–∂–∞–ª –Ω–∞ —Å–≤–æ—ë–º –º–µ—Å—Ç–µ. –ò –∫–æ–ª–æ–¥–µ—Ü –≤—Å—ë —Ç–∞–∫ –ø–æ–¥–Ω–∏–º–∞–ª —Ä—É—á–∫—É –≤–≤–µ—Ä—Ö.

–ò–∑ —Ö–æ–ª–æ–¥–Ω–æ–π –∫—É—á–∏ –∫–∞–º–Ω–µ–π –≤–æ–∑–ª–µ –¥–æ–º–∞ –≤—ã–±—Ä–∞–ª –æ–¥–∏–Ω –∏ —Å—É–Ω—É–ª –≤ –∫–∞—Ä–º–∞–Ω –≥—Ä–µ—Ç—å. –ñ–µ–Ω–∞ –¥–≤–µ—Ä—å –æ—Ç–≤–æ—Ä–∏–ª–∞ –∑–∞—Ä–∞–Ω–µ. –û–Ω –ø—Ä–æ—Ç—è–Ω—É–ª –µ–π —Ö–ª–µ–±, –ø–æ—É–∂–∏–Ω–∞–ª –Ω–µ—Å–ª–æ–∂–Ω–æ, —á—Ç–æ–±—ã –∑–∞–±—ã—Ç—å, –∏ –ª—ë–≥. –ü–æ—Å–ª—É—à–∞–ª –∫–∞–∫ –∂–µ–Ω–∞ –º–æ–ª–∏–ª–∞—Å—å, –≥—É–±–∞–º–∏ —à–µ–≤–µ–ª–∏–ª. –ò —É–∂–µ –∑–∞—Å—ã–ø–∞–ª, –æ–Ω–∞ —Å–ø—Ä–æ—Å–∏–ª–∞:

‚Äì –ù—É, —á–µ–≥–æ?

‚Äì –ß–µ–≥–æ?

‚Äì –ù–∏—á–µ–≥–æ?

‚Äì –ù–∏—á–µ–≥–æ.

‚Äì –ù—É, –Ω–∏—á–µ–≥–æ ‚Äì —Ç–∞–∫ –Ω–∏—á–µ–≥–æ: —É—Ç—Ä–æ –≤–µ—á–µ—Ä–∞ –º—É–¥—Ä–µ–Ω–µ–µ.`;
